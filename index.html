<!DOCTYPE html>
<html>
<head>
    <title>PDF to Excel Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 20px auto; 
            padding: 0 20px; 
        }
        .drop-zone {
            width: 100%;
            height: 200px;
            border: 2px dashed #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            cursor: pointer;
        }
        .drop-zone:hover {
            border-color: #0066cc;
        }
        .drop-zone.dragover {
            background: #e1f0ff;
            border-color: #0066cc;
        }
        button { 
            padding: 10px 20px; 
            background: #0066cc; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
        }
        button:hover { 
            background: #0052a3; 
        }
        #status {
            margin: 20px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #e6ffe6;
            color: #006600;
        }
        .error {
            background: #ffe6e6;
            color: #660000;
        }
    </style>
</head>
<body>
    <h1>PDF to Excel Converter</h1>
    
    <div class="drop-zone" id="dropZone">
        <div>
            Drop PDF file here or click to upload
            <input type="file" id="fileInput" accept=".pdf" style="display: none;">
        </div>
    </div>

    <div id="status"></div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        function processLine(line) {
            const regex = /(\S+(?:\s+\S+)*?)\s+(\d{4})\s+([\w\-]+)\s+€\s*(\d+(?:\.\d+)?)\s*(?:€\s*(\d+(?:\.\d+)?))?\s*(?:€\s*(\d+(?:\.\d+)?))?\s*(?:€\s*(\d+(?:\.\d+)?))?\s*(?:€\s*(\d+(?:\.\d+)?))?\s*(?:€\s*(\d+(?:\.\d+)?))?\s*/;
            const match = line.match(regex);
            
            if (match) {
                const [_, product, division, code, price1kg, price5kg, price10kg, price17_18kg, price20_25kg, price100kg] = match;
                
                const rows = [];
                
                if (price1kg) {
                    rows.push({
                        'Product': product.trim(),
                        'Product Code': code,
                        'Quantity': '1kg',
                        'Price': parseFloat(price1kg)
                    });
                }
                if (price5kg) {
                    rows.push({
                        'Product': product.trim(),
                        'Product Code': code,
                        'Quantity': '5kg',
                        'Price': parseFloat(price5kg)
                    });
                }
                if (price10kg) {
                    rows.push({
                        'Product': product.trim(),
                        'Product Code': code,
                        'Quantity': '10kg',
                        'Price': parseFloat(price10kg)
                    });
                }
                if (price17_18kg) {
                    rows.push({
                        'Product': product.trim(),
                        'Product Code': code,
                        'Quantity': '17-18kg',
                        'Price': parseFloat(price17_18kg)
                    });
                }
                if (price20_25kg) {
                    rows.push({
                        'Product': product.trim(),
                        'Product Code': code,
                        'Quantity': '20-25kg',
                        'Price': parseFloat(price20_25kg)
                    });
                }
                if (price100kg) {
                    rows.push({
                        'Product': product.trim(),
                        'Product Code': code,
                        'Quantity': '100kg',
                        'Price': parseFloat(price100kg)
                    });
                }
                
                return rows;
            }
            return [];
        }

        async function extractTextFromPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
            let fullText = '';
            
            for(let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ');
                fullText += pageText + '\n';
            }
            
            return fullText;
        }

        async function handleFile(file) {
            try {
                const status = document.getElementById('status');
                status.textContent = 'Processing PDF...';
                status.className = '';

                const text = await extractTextFromPDF(file);
                const lines = text.split('\n');
                const allRows = [];
                
                lines.forEach(line => {
                    if (line.trim() && !line.includes('CONFIDENTIAL') && !line.includes('Division Product code')) {
                        const rows = processLine(line);
                        allRows.push(...rows);
                    }
                });
                
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(allRows);
                
                XLSX.utils.book_append_sheet(wb, ws, "Price Breaks");
                XLSX.writeFile(wb, 'price_breaks.xlsx');

                status.textContent = 'Excel file created successfully!';
                status.className = 'success';
            } catch (error) {
                console.error(error);
                status.textContent = 'Error processing PDF: ' + error.message;
                status.className = 'error';
            }
        }

        // Set up the drop zone
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        dropZone.addEventListener('click', () => fileInput.click());
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'application/pdf') {
                handleFile(file);
            }
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.type === 'application/pdf') {
                handleFile(file);
            }
        });
    </script>
</body>
</html>
